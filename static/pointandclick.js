(function(){var t,e,i={}.hasOwnProperty;e=function(){class t{constructor(t,e){this.element=$(t),this.settings=$.extend({},this.constructor.defaults,e),this.feedbackDiv=this.element.find(this.settings.feedback_selector),this.infoDiv=this.element.find(this.settings.info_selector),this.contentDiv=this.element.find(this.settings.content_selector)}init(){return this.setInfoPosition(),$(window).on("resize",()=>this.setInfoPosition())}showFeedback(t){var e,i,s;if(e=t.data("label"),s=t.data("id"),i=window.pointandclick[e],this.feedbackDiv.removeClass("correct wrong neutral"),i)return"true"===i.correct?this.feedbackDiv.addClass("correct"):"false"===i.correct?this.feedbackDiv.addClass("wrong"):this.feedbackDiv.addClass("neutral"),i.feedback?this.feedbackDiv.html(i.feedback):this.feedbackDiv.html("[No feedback set]");this.feedbackDiv.text("[Error: question payload not configured (id="+s+")]")}setInfoPosition(){var t;return.8*$(window).height()>this.contentDiv.height()?(this.infoDiv.removeClass("fixed"),this.contentDiv.removeClass("fixed-info"),this.infoDiv.css("maxHeight",""),this.contentDiv.css("marginBottom","")):(this.infoDiv.addClass("fixed"),this.contentDiv.addClass("fixed-info"),t=.25*$(window).height(),this.infoDiv.css("maxHeight",t),this.contentDiv.css("marginBottom",t))}}return t.defaults={feedback_selector:".pointandclick-feedback",info_selector:".pointandclick-info",content_selector:".pointandclick-content",clickable_selector:".clickable",clickable_class:"clickable"},t}.call(this),t=function(){class t extends e{constructor(t,e){super(t,e),this.completed=!1,this.questionAnswered={},this.idToLabel={},this.pointsDiv=this.element.find(this.settings.points_selector),this.completeDiv=this.element.find(this.settings.completed_selector),this.completeMsg=this.element.find(this.settings.completed_msg_selector),this.finalComment=this.element.find(this.settings.final_comment_selector),this.correctPointsElem=this.element.find(this.settings.correct_clicks_selector),this.wrongPointsElem=this.element.find(this.settings.wrong_clicks_selector),this.clicksLeftMsgDiv=this.element.find(this.settings.clicks_left_msg_selector),this.contentDiv=this.element.find(this.settings.content_selector),this.infoDiv=this.element.find(this.settings.info_selector),this.correctClicks=0,this.incorrectClicks=0,this.maxCorrectClicks=0,this.clickLog=[],this.init()}init(){var t,e;return e=this,t=0,this.element.find(this.settings.clickable_selector).each(function(){var i,s;return s=t++,$(this).data("id",s),i=$(this).data("label"),"true"===window.pointandclick[i].correct&&e.maxCorrectClicks++,e.questionAnswered[s]=!1,e.idToLabel[s]=i}).click(function(t){return e.clickWord(t,$(this))}),super.init()}clickWord(t,e){var i,s,n,c,o;return n=e.data("id"),c=e.data("label"),s=window.pointandclick[c],o=this.questionAnswered[n],this.completed&&!o?(t.preventDefault(),!1):(this.questionAnswered[n]=!0,this.showFeedback(e),s&&("true"===s.correct?(e.addClass("correct"),o||(this.correctClicks+=1)):"false"===s.correct?(e.addClass("wrong"),o||(this.incorrectClicks+=1)):e.addClass("neutral"),s.reveal&&!o&&e.html(s.reveal),!this.completed)?(i={qid:n,qlabel:c,time:(new Date).toISOString()},o&&(i.rerun=!0),this.clickLog.push(i),this.updatePoints(),this.updateCorrectClicksLeftCounter(),this.checkCompletion()):void 0)}updateCorrectClicksLeftCounter(){var t,e,i;if(this.correctClicks>=.5*this.maxCorrectClicks)return i=1===(t=this.maxCorrectClicks-this.correctClicks)?this.settings.clicks_left_singular_msg_attr:this.settings.clicks_left_plural_msg_attr,e=(e=this.clicksLeftMsgDiv.attr(i)).replace("{counter}",t.toString()),this.clicksLeftMsgDiv.html(e),this.clicksLeftMsgDiv.removeClass("hide").show()}checkCompletion(){if(this.correctClicks>=this.maxCorrectClicks)return this.completed=!0,this.clicksLeftMsgDiv.hide(),this.completeMsg.text(this.completeDiv.attr(this.settings.complete_msg_attr)),this.completeDiv.removeClass("hide").show(),this.grade(),this.sendLog()}grade(){var t,e;if("/html/"!==window.location.pathname.substring(0,6)&&this.completeMsg.text(this.completeDiv.attr(this.settings.complete_uploading_msg_attr)),e=Math.round(this.maxCorrectClicks/(this.correctClicks+this.incorrectClicks)*100),this.addFinalPointsString(this.pointsDiv,e),this.showFinalComment(e),t=this.buildFinalFeedback(),window.ACOS)return window.ACOS.sendEvent("grade",{max_points:100,points:e,feedback:t},(t,e)=>{if(!e)return"/html/"!==window.location.pathname.substring(0,6)?this.completeMsg.text(this.completeDiv.attr(this.settings.complete_uploaded_msg_attr)):void 0;this.completeMsg.text(this.completeDiv.attr(this.settings.complete_error_msg_attr)+e.error)})}buildFinalFeedback(){var t,e,s,n;for(n in e=[],s=this.questionAnswered)i.call(s,n)&&s[n]&&(t=this.idToLabel[n],-1===e.indexOf(t)&&e.push(t));return{answers:{answers:this.questionAnswered,labelsUsed:e},correctAnswers:this.correctClicks,incorrectAnswers:this.incorrectClicks}}addFinalPointsString(t,e){var i;return i=(i=t.attr(this.settings.final_points_msg_attr)).replace("{score}",e.toString()),t.prepend(i)}updatePoints(){return this.correctPointsElem.text(this.correctClicks),this.wrongPointsElem.text(this.incorrectClicks),this.pointsDiv.removeClass("hide").show()}showFinalComment(t){var e,s,n,c,o,r;if(r=window.pointandclick.finalcomment){for(n in s="",r.common&&(s+=r.common+"<br>"),o=[],r)i.call(r,n)&&(r[n],c=parseInt(n,10),isNaN(c)||o.push([c,n]));return o.sort(function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0}),-1!==(e=o.findIndex(function(e){return t<=e[0]}))&&(s+=r[o[e][1]]),this.finalComment.html(s),this.finalComment.removeClass("hide").show()}}sendLog(){if(window.ACOS)return window.ACOS.sendEvent("log",this.clickLog)}}return t.pluginName="acosPointAndClick",t.defaults=$.extend({},e.defaults,{points_selector:".pointandclick-points",correct_clicks_selector:".pointandclick-correct-clicks",wrong_clicks_selector:".pointandclick-wrong-clicks",completed_selector:".pointandclick-complete",complete_msg_attr:"data-msg-complete",complete_uploading_msg_attr:"data-msg-complete-uploading",complete_uploaded_msg_attr:"data-msg-complete-uploaded",complete_error_msg_attr:"data-msg-complete-error",completed_msg_selector:".pointandclick-complete-msg",final_comment_selector:".pointandclick-finalcomment",final_points_msg_attr:"data-msg-final",clicks_left_msg_selector:".pointandclick-clicksleftmsg",clicks_left_singular_msg_attr:"data-msg-singular",clicks_left_plural_msg_attr:"data-msg-plural"}),t}.call(this),$.fn[t.pluginName]=function(e){return this.each(function(){if(!$.data(this,"plugin_"+t.pluginName))return $.data(this,"plugin_"+t.pluginName,new t(this,e))})},$(function(){return $(".pointandclick").acosPointAndClick()})}).call(this);